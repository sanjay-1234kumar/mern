let express,APP_PORT,DB_URL,routes,errorHandler,bodyPaser,cors,mongoose,path,multer;_6cb‍.w("express",[["default",["express"],function(v){express=v}]]);_6cb‍.w("./config/index",[["APP_PORT",["APP_PORT"],function(v){APP_PORT=v}],["DB_URL",["DB_URL"],function(v){DB_URL=v}]]);_6cb‍.w("./routes/index",[["default",["routes"],function(v){routes=v}]]);_6cb‍.w("./middleware/errorhandler",[["default",["errorHandler"],function(v){errorHandler=v}]]);_6cb‍.w("body-parser",[["default",["bodyPaser"],function(v){bodyPaser=v}]]);_6cb‍.w("cors",[["default",["cors"],function(v){cors=v}]]);_6cb‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_6cb‍.w("path",[["default",["path"],function(v){path=v}]]);_6cb‍.w("multer",[["default",["multer"],function(v){multer=v}]]);
// we are statring from sever.js file 
 



let app=express();
















const storage = multer.diskStorage({
  destination: function (req, file, cb) {
    cb(null, 'tmp/');
    
  },
  filename: function (req, file, cb) {
    const unique_name = `${Date.now()}-${Math.round(Math.random() * 100000)}${path.extname(file.originalname)}`;

    cb(null, unique_name);

  }
});


const upload=multer({storage:storage}).single('image');








global.appRoot=path.resolve(__dirname);



// third-party middleware 

app.use(cors());

app.use(bodyPaser.json());

app.use(bodyPaser.urlencoded({extended:false}));

// databse connection code 
mongoose.connect(DB_URL,{
    useNewUrlParser:true,
    useUnifiedTopology:true,
    useFindAndModify:false,
    useCreateIndex:true
}).then((res)=>{
  console.log("we are connected to data base");
}).catch((e)=>{
console.log("we are not connected to databse");
  _6cb‍.g.console.log(e);
});


// setting of static file 
app.use('/uploads',express.static('uploads'));
app.use('/subupload',express.static('subupload'));
app.use('/caterupload',express.static('caterupload'));


// routes for start application 

app.use('/api',routes);


// route not found error 

app.get('/',(req,res,next)=>{

  return res.sendFile(__dirname+'/index.html');
});

// for error handling middle ware 


app.post('/test',(req,res,next)=>{

  console.log("we are testing ...");

  _6cb‍.g.console.log(req.body);

_6cb‍.g.console.log(req.file);

upload(req,res,(err)=>{
// error in the uploading

if(err){

  console.log("multer error is coming coming....");

  _6cb‍.g.console.log(err);

  return next(err);

}

console.log("every thing is ok ");

_6cb‍.g.console.log(req.body);

_6cb‍.g.console.log(req.file);

return res.json("file is uploaded sucessfully");



});






});
app.use(errorHandler);


app.listen(APP_PORT,()=>{

    console.log(`sever running at port ${APP_PORT}`);

});














